# **Bakery Algorithm in Process Synchronization**

---

## 1. Introduction

In a multitasking operating system, **multiple processes may need to access a shared resource** (critical section).

If access is not properly controlled, it leads to:

* **Race conditions**
* **Incorrect results**
* **System inconsistency**

To prevent this, the OS must enforce **mutual exclusion**.

The **Bakery Algorithm**, proposed by **Leslie Lamport**, is a **pure software-based solution** to the **critical section problem for N processes**.

> Unlike Peterson’s Algorithm (which works for only two processes),
> **Bakery Algorithm works for multiple processes**.

---

## 2. Why Bakery Algorithm Was Needed

Early synchronization solutions had limitations:

* Peterson’s Algorithm → only **2 processes**
* Hardware support → not always available
* OS designers wanted a **general software solution**

Bakery Algorithm was designed to:

* Handle **N processes**
* Ensure **fairness**
* Guarantee **no starvation**
* Use only **shared variables**

It proves that **correct synchronization is possible even without hardware locks**.

---

## 3. Core Intuition Behind the Algorithm

The algorithm is inspired by a **real-life bakery system**.

### Bakery Analogy

* Customers take a **number (token)**
* The customer with the **smallest number is served first**
* If two customers get the same number, **lower ID wins**

In OS terms:

* Each process takes a **ticket**
* The process with the **smallest ticket enters the critical section**
* Others wait politely

This guarantees:

* Order
* Fairness
* No conflict

---

## 4. Shared Variables Used

Bakery Algorithm uses **two shared arrays**, accessible by all processes.

---

### 4.1 `choosing[i]` — Choosing Flag

* `choosing[i] = true` → Process `Pi` is choosing a ticket
* Prevents reading **half-written ticket values**

This avoids **inconsistent comparisons**.

---

### 4.2 `number[i]` — Ticket Number

* Stores the ticket assigned to process `Pi`
* `number[i] = 0` → Process is not interested
* Smaller number = higher priority

---

## 5. Lexicographical Ordering (Very Important)

When deciding priority between two processes `Pi` and `Pj`, the algorithm compares:

```
(number[i], i) < (number[j], j)
```

Meaning:

1. Smaller ticket number wins
2. If ticket numbers are equal, smaller process ID wins

This guarantees **deterministic and fair ordering**.

---

## 6. Algorithm Pseudocode

Assume **N processes**: `P0, P1, ..., Pn-1`

```c
repeat

    choosing[i] := true
    number[i] := max(number[0..n-1]) + 1
    choosing[i] := false

    for j := 0 to n-1 do
        while choosing[j] do skip
        while number[j] ≠ 0 and (number[j], j) < (number[i], i) do skip
    end for

    // -------- Critical Section --------

    number[i] := 0

    // -------- Remainder Section --------

until false
```

---

## 7. Step-by-Step Working (Internal Logic)

---

### Step 1: Choosing a Ticket

```c
choosing[i] := true;
number[i] := max(number[]) + 1;
choosing[i] := false;
```

Meaning:

* Process announces: “I am choosing my ticket”
* Picks a ticket **greater than all existing ones**
* Finishes choosing safely

---

### Step 2: Waiting Phase

For every other process `j`:

```c
while choosing[j] do wait;
```

Ensures process `j` finishes choosing its ticket first.

```c
while number[j] ≠ 0 and (number[j], j) < (number[i], i) do wait;
```

Process `i` waits if:

* Process `j` wants the critical section
* And `j` has **higher priority**

---

### Step 3: Enter Critical Section

* No other process has a smaller ticket
* Safe entry
* Mutual exclusion guaranteed

---

### Step 4: Exit Section

```c
number[i] := 0;
```

Process releases its ticket so others can proceed.

---

### Step 5: Remainder Section

* Process does normal work
* Then repeats the cycle

---

## 8. Why Bakery Algorithm Is Correct

The algorithm satisfies **all three critical section requirements**.

---

### 8.1 Mutual Exclusion

* Only the process with **minimum ticket** enters
* Two processes cannot be inside simultaneously

---

### 8.2 Progress

* If critical section is free
* One of the waiting processes will be selected
* No deadlock

---

### 8.3 Bounded Waiting (No Starvation)

* Tickets increase monotonically
* Every process will eventually get the smallest ticket

---

## 9. Comparison with Peterson’s Algorithm

| Feature             | Peterson’s Algorithm | Bakery Algorithm |
| ------------------- | -------------------- | ---------------- |
| Processes supported | 2                    | N                |
| Software-based      | Yes                  | Yes              |
| Fairness            | Yes                  | Yes (FCFS)       |
| Busy waiting        | Yes                  | Yes              |
| Practical use       | Theoretical          | Theoretical      |

---

## 10. Theoretical Use Cases

* Multiple processes accessing a shared log file
* Processes updating a shared counter
* Educational understanding of synchronization

> Used only for **learning and proofs**, not real OS kernels.

---

## 11. Limitations of Bakery Algorithm

Despite correctness, it is **not used in modern OS**.

### Major Issues

1. **Busy Waiting**

   * Wastes CPU cycles
2. **Not Scalable**

   * O(N) waiting for each process
3. **Memory Reordering Problems**

   * Modern CPUs may break assumptions
4. **High Overhead**

   * Shared arrays + comparisons
5. **No Hardware Support**

   * Modern OS prefer atomic instructions

---

## 12. Interview Questions

### Basic

1. What is the Bakery Algorithm?
2. Which problem does it solve?
3. Who proposed it?

---

### Conceptual

1. Why is lexicographical ordering used?
2. What is the role of `choosing[]`?
3. How does the algorithm ensure fairness?

---

### Tricky

1. Is Bakery Algorithm used in modern OS?
   → No, only theoretical importance.

2. Does Bakery Algorithm cause starvation?
   → No, it guarantees bounded waiting.

---

## 13. Key Takeaways

* Bakery Algorithm is a **software-only synchronization solution**
* Works for **multiple processes**
* Guarantees:

  * Mutual Exclusion
  * Progress
  * Bounded Waiting
* Uses **ticket-based fairness**
* Important for **conceptual understanding**, not performance

> **Bakery Algorithm teaches correctness and fairness, not efficiency.**
